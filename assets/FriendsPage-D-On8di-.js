import{_ as y,u as N,o,c,b as h,i as I,F as $,j as C,k as g,t as U,s as w,r as f,l as L,w as k,v as V,m as q,e as F,a as A,n as E,p as B,g as _}from"./index-B_YhoeON.js";const D={key:0},P=["onClick"],j=["onClick"],T={__name:"FriendsList",props:{friends:Array,user:Object},setup(r){const d=N(),n=r,a=s=>{d.push({name:"Profile",params:{username:s.username}})},i=async s=>{try{if(!n.user){console.error("Пользователь не авторизован");return}const{data:e,error:t}=await w.from("chats").select("*").or(`user1_id.eq.${n.user.id},user2_id.eq.${n.user.id}`).or(`user1_id.eq.${s.id},user2_id.eq.${s.id}`);if(t)throw t;let u;if(e.length>0)u=e[0].id;else{const{data:m,error:v}=await w.from("chats").insert([{user1_id:n.user.id,user2_id:s.id}]).select();if(v)throw v;u=m[0].id}d.push({name:"ChatsDetails",params:{id:u}})}catch(e){console.error("Ошибка при создании чата:",e)}};return(s,e)=>(o(),c("div",null,[e[0]||(e[0]=h("h2",null,"Друзья",-1)),h("ul",null,[r.friends.length===0?(o(),c("li",D,"Список друзей пуст")):I("",!0),(o(!0),c($,null,C(r.friends,t=>(o(),c("li",{key:t.id},[g(U(t.username)+" ",1),h("button",{onClick:u=>i(t)},"Написать сообщение",8,P),h("button",{onClick:u=>a(t)},"Профиль",8,j)]))),128))])]))}},M=y(T,[["__scopeId","data-v-8c1fea55"]]),O={__name:"UserSearch",props:{search:String,users:Array,loadUsers:Function},emits:["update:search"],setup(r,{emit:d}){const n=r,a=d,i=f(n.search);L(i,e=>{a("update:search",e)});const s=()=>{n.loadUsers()};return(e,t)=>(o(),c("div",null,[k(h("input",{type:"search","onUpdate:modelValue":t[0]||(t[0]=u=>i.value=u),onInput:s,placeholder:"Поиск пользователей..."},null,544),[[V,i.value]]),k(h("p",null,"Пользователи не найдены.",512),[[q,r.users.length===0]])]))}},R=y(O,[["__scopeId","data-v-88cc3f1b"]]),z=["onClick","disabled"],G=["onClick"],H={__name:"UserList",props:{users:Array,addFriend:Function,removeFriend:Function,isFriend:Function,notices:{type:Array,default:()=>[]}},setup(r){const d=r,n=F(()=>{const a={};return d.notices.forEach(i=>{a[i.sender_id]=i.notice_type==="sentFriend"}),a});return(a,i)=>(o(),c("ul",null,[(o(!0),c($,null,C(r.users,s=>(o(),c("li",{key:s.id},[g(U(s.username)+" ",1),r.isFriend(s.id)?(o(),c("button",{key:1,onClick:e=>r.removeFriend(s)},"Удалить из друзей",8,G)):(o(),c("button",{key:0,onClick:e=>r.addFriend(s),disabled:n.value[s.id]}," Добавить в друзья ",8,z))]))),128))]))}},J=y(H,[["__scopeId","data-v-de0463e1"]]),Q={__name:"FriendsPage",setup(r){const d=A(),n=E(),a=B(),i=F(()=>n.friends),s=f([]),e=F(()=>d.user),t=f(""),u=F(()=>a.notices),m=async()=>{s.value=await d.getUsers(t.value)},v=l=>i.value.some(p=>p.id===l),b=async l=>{await a.addNotice(e.value.id,l.id,`Пользователь ${e.value.username} хочет добавить вас в друзья.`,"addFriend"),await a.addNotice(l.id,e.value.id,`Отправлена заявка ${l.username} `,"sentFriend"),await m(),await n.getFriends(e.value.id),await a.getNotices(e.value.id)},S=async l=>{await n.removeFriend(e.value.id,l.id),await m()};return(l,p)=>(o(),c("div",null,[_(M,{friends:i.value,user:e.value},null,8,["friends","user"]),_(R,{search:t.value,"onUpdate:search":p[0]||(p[0]=x=>t.value=x),users:s.value,loadUsers:m},null,8,["search","users"]),_(J,{users:s.value,addFriend:b,removeFriend:S,isFriend:v,notices:u.value},null,8,["users","notices"])]))}};export{Q as default};
