import{f,r as t,g as U,u as w,s as p,a as h,h as m,v as d,b as l,t as x,e as E}from"./index-DJBnHZvH.js";import{u as _}from"./errors-B0OIaOmT.js";const y=f("userRegister",()=>{const u=t(""),r=t(""),s=t(""),a=_(),n=U(),i=w();async function c(){const{data:g,error:e}=await p.from("users").select("id").eq("username",s.value).single();if(e&&e.code!=="PGRST116"){console.error("Ошибка при проверке имени пользователя:",e);return}if(g){console.error("Имя пользователя уже занято. Пожалуйста, выберите другое."),a.setErrors("Имя пользователя уже занято. Пожалуйста, выберите другое.");return}const{error:o}=await p.auth.signUp({email:u.value,password:r.value});if(o){console.error("Ошибка при регистрации:",o);return}const{error:v}=await p.from("users").insert([{username:s.value,email:u.value}]).select();v?console.error("Ошибка при добавлении имени пользователя:",v):(console.log("Пользователь успешно зарегистрирован с именем пользователя:",s.value),n.push("/"),await i.fetchUser())}return{registerUser:c,email:u,password:r,username:s}}),R={class:"form"},V={__name:"RegisterPage",setup(u){const r=y(),s=t(""),a=t(""),n=t(""),i=()=>{r.email=s.value,r.password=a.value,r.username=n.value,r.registerUser()},c=t(r.errorMessages);return(g,e)=>(E(),h("div",R,[m(l("input",{type:"text",id:"username","onUpdate:modelValue":e[0]||(e[0]=o=>n.value=o),placeholder:"Имя пользователя",maxlength:"15"},null,512),[[d,n.value]]),m(l("input",{type:"email",id:"email","onUpdate:modelValue":e[1]||(e[1]=o=>s.value=o),placeholder:"Почта",maxlength:"25"},null,512),[[d,s.value]]),m(l("input",{type:"password",id:"password","onUpdate:modelValue":e[2]||(e[2]=o=>a.value=o),placeholder:"Пароль",maxlength:"20"},null,512),[[d,a.value]]),l("button",{onClick:i,class:"form__btn"},"Зарегистрироваться"),l("pre",null,x(c.value),1)]))}};export{V as default};
