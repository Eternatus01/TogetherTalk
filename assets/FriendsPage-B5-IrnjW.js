import{_ as y,g as N,e as o,a as c,b as h,i as I,F as $,j as C,k as g,t as U,s as w,r as f,w as L,h as k,v as V,l as q,c as p,u as A,m as E,n as B,d as F}from"./index-CauTUp0A.js";const D={class:"friends-list"},P={key:0},j=["onClick"],T=["onClick"],M={__name:"FriendsList",props:{friends:Array,user:Object},setup(r){const d=N(),n=r,a=s=>{d.push({name:"Profile",params:{username:s.username}})},i=async s=>{try{if(!n.user){console.error("Пользователь не авторизован");return}const{data:e,error:t}=await w.from("chats").select("*").or(`user1_id.eq.${n.user.id},user2_id.eq.${n.user.id}`).or(`user1_id.eq.${s.id},user2_id.eq.${s.id}`);if(t)throw t;let u;if(e.length>0)u=e[0].id;else{const{data:v,error:m}=await w.from("chats").insert([{user1_id:n.user.id,user2_id:s.id}]).select();if(m)throw m;u=v[0].id}d.push({name:"ChatsDetails",params:{id:u}})}catch(e){console.error("Ошибка при создании чата:",e)}};return(s,e)=>(o(),c("div",D,[e[0]||(e[0]=h("h2",null,"Друзья",-1)),h("ul",null,[r.friends.length===0?(o(),c("li",P,"Список друзей пуст")):I("",!0),(o(!0),c($,null,C(r.friends,t=>(o(),c("li",{key:t.id},[g(U(t.username)+" ",1),h("button",{onClick:u=>i(t)},"Написать сообщение",8,j),h("button",{onClick:u=>a(t)},"Профиль",8,T)]))),128))])]))}},O=y(M,[["__scopeId","data-v-c64da3ac"]]),R={__name:"UserSearch",props:{search:String,users:Array,loadUsers:Function},emits:["update:search"],setup(r,{emit:d}){const n=r,a=d,i=f(n.search);L(i,e=>{a("update:search",e)});const s=()=>{n.loadUsers()};return(e,t)=>(o(),c("div",null,[k(h("input",{type:"search","onUpdate:modelValue":t[0]||(t[0]=u=>i.value=u),onInput:s,placeholder:"Поиск пользователей..."},null,544),[[V,i.value]]),k(h("p",null,"Пользователи не найдены.",512),[[q,r.users.length===0]])]))}},z=y(R,[["__scopeId","data-v-f74954a3"]]),G=["onClick","disabled"],H=["onClick"],J={__name:"UserList",props:{users:Array,addFriend:Function,removeFriend:Function,isFriend:Function,notices:{type:Array,default:()=>[]}},setup(r){const d=r,n=p(()=>{const a={};return d.notices.forEach(i=>{a[i.sender_id]=i.notice_type==="sentFriend"}),a});return(a,i)=>(o(),c("ul",null,[(o(!0),c($,null,C(r.users,s=>(o(),c("li",{key:s.id},[g(U(s.username)+" ",1),r.isFriend(s.id)?(o(),c("button",{key:1,onClick:e=>r.removeFriend(s)},"Удалить из друзей",8,H)):(o(),c("button",{key:0,onClick:e=>r.addFriend(s),disabled:n.value[s.id]}," Добавить в друзья ",8,G))]))),128))]))}},K=y(J,[["__scopeId","data-v-048d7b0c"]]),Q={class:"users_search"},X={__name:"FriendsPage",setup(r){const d=A(),n=E(),a=B(),i=p(()=>n.friends),s=f([]),e=p(()=>d.user),t=f(""),u=p(()=>a.notices),v=async()=>{s.value=await d.getUsers(t.value)},m=l=>i.value.some(_=>_.id===l),b=async l=>{await a.addNotice(e.value.id,l.id,`Пользователь ${e.value.username} хочет добавить вас в друзья.`,"addFriend"),await a.addNotice(l.id,e.value.id,`Отправлена заявка ${l.username} `,"sentFriend"),await v(),await n.getFriends(e.value.id),await a.getNotices(e.value.id)},S=async l=>{await n.removeFriend(e.value.id,l.id),await v()};return(l,_)=>(o(),c("div",null,[F(O,{friends:i.value,user:e.value},null,8,["friends","user"]),h("div",Q,[F(z,{search:t.value,"onUpdate:search":_[0]||(_[0]=x=>t.value=x),users:s.value,loadUsers:v},null,8,["search","users"]),F(K,{users:s.value,addFriend:b,removeFriend:S,isFriend:m,notices:u.value},null,8,["users","notices"])])]))}};export{X as default};
