import{u as b,_ as x}from"./PostList-CYQVwUVp.js";import{u as $,r as a,c as w,e as o,a as i,h as k,v as U,b as r,t as S,i as f,s as E,_ as N,o as A,p as P,d as g,q as D,x as F}from"./index-gtoVCd26.js";import{A as I}from"./Avatar-Cf6ziEZz.js";import"./DisplayAvatar-BnDMc2eB.js";const L={class:"create-post"},M=["disabled"],R={key:0},T={key:1},q={key:0,class:"error"},z={__name:"CreatePost",setup(V){const d=$(),c=b(),t=a(""),p=a(""),v=a(""),s=a(!1),y=w(()=>t.value.trim().length>0),h=async()=>{var m;try{if(v.value="",s.value=!0,!((m=d.user)!=null&&m.id))throw new Error("Пользователь не авторизован");const{data:e,error:l}=await E.from("posts").insert({user_id:d.user.id,title:p.value.trim()||"Без названия",username:d.user.username,text:t.value.trim()}).select("*").single();if(l)throw l;c.posts=[e,...c.posts],t.value="",p.value=""}catch(e){v.value=e.message||"Ошибка при создании поста",console.error("Post creation error:",e)}finally{s.value=!1}};return(m,e)=>(o(),i("div",L,[k(r("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=l=>p.value=l),placeholder:"Заголовок",class:"post-input",maxlength:"60"},null,512),[[U,p.value]]),k(r("textarea",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.value=l),placeholder:"Что у вас нового?",rows:"3",class:"post-textarea",maxlength:"1000"},null,512),[[U,t.value]]),r("button",{onClick:h,disabled:!y.value||s.value,class:"post-button"},[s.value?(o(),i("span",T,"Публикация...")):(o(),i("span",R,"Опубликовать"))],8,M),v.value?(o(),i("p",q,S(v.value),1)):f("",!0)]))}},O={class:"profile"},j={key:0},G={class:"profile-info"},H={class:"profile-text"},J={class:"profile-name"},K={key:0},Q={key:0,class:"create-and-posts"},W={__name:"ProfilePage",setup(V){const d=$(),c=w(()=>d.user),t=a(""),p=a(""),v=a(""),s=a(""),y=a(""),h=b(),m=a(!1),e=w(()=>h.getUserPosts(s.value)),l=()=>{const n=new URL(window.location.href);n.searchParams.set("username",t.value),window.history.pushState({},"",n.href),B()},B=async()=>{const n=window.location,u=n.pathname.substring(n.pathname.lastIndexOf("/")+1),_=await d.getUserByUsername(u);u&&(t.value=u,p.value=_.email,v.value=_.avatar_url,s.value=_.id),await C()},C=async()=>{try{m.value=!0,await h.fetchUserPosts(s.value,{forceRefresh:!0})}catch(n){y.value=n.message||"Ошибка загрузки постов"}finally{m.value=!1}};return A(async()=>{l()}),(n,u)=>{const _=D("router-link");return o(),i("section",null,[r("section",O,[c.value?(o(),i("div",j,[s.value===c.value.id?(o(),P(_,{key:0,to:"/settings"},{default:F(()=>u[0]||(u[0]=[r("span",{class:"material-icons"},"Настройки",-1)])),_:1})):f("",!0)])):f("",!0),r("div",G,[g(I,{size:50,username:t.value},null,8,["username"]),r("div",H,[u[1]||(u[1]=r("small",null,"Username",-1)),r("h2",J,S(t.value),1)])])]),c.value?(o(),i("div",K,[s.value===c.value.id?(o(),i("section",Q,[g(z),g(x,{posts:e.value},null,8,["posts"])])):s.value?(o(),P(x,{key:1,posts:e.value},null,8,["posts"])):f("",!0)])):f("",!0)])}}},se=N(W,[["__scopeId","data-v-56d05abd"]]);export{se as default};
