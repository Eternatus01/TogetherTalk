import{u as V,_ as k}from"./PostList-CubIlNhx.js";import{u as $,r as s,c as w,e as a,a as i,b as n,h as P,v as U,t as S,i as h,s as R,_ as T,o as A,p as b,d as g,k as D,q as F,x as I,y as L}from"./index-CauTUp0A.js";import{A as M}from"./Avatar-wjKssGD2.js";import"./DisplayAvatar-C0hXYKws.js";const q={class:"create-post"},z=["disabled"],O={key:0},j={key:1},G={key:0,class:"error"},H={__name:"CreatePost",setup(B){const p=$(),m=V(),t=s(""),o=s(""),c=s(""),d=s(!1),y=w(()=>t.value.trim().length>0),l=async()=>{var _;try{if(c.value="",d.value=!0,!((_=p.user)!=null&&_.id))throw new Error("Пользователь не авторизован");const{data:e,error:r}=await R.from("posts").insert({user_id:p.user.id,title:o.value.trim()||"Без названия",username:p.user.username,text:t.value.trim()}).select("*").single();if(r)throw r;m.posts=[e,...m.posts],t.value="",o.value=""}catch(e){c.value=e.message||"Ошибка при создании поста",console.error("Post creation error:",e)}finally{d.value=!1}};return(_,e)=>(a(),i("div",q,[e[2]||(e[2]=n("h2",null," Создать пост: ",-1)),P(n("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=r=>o.value=r),placeholder:"Заголовок",class:"post-input",maxlength:"60"},null,512),[[U,o.value]]),P(n("textarea",{"onUpdate:modelValue":e[1]||(e[1]=r=>t.value=r),placeholder:"Что у вас нового?",rows:"3",class:"post-textarea",maxlength:"1000"},null,512),[[U,t.value]]),n("button",{onClick:l,disabled:!y.value||d.value,class:"post-button"},[d.value?(a(),i("span",j,"Публикация...")):(a(),i("span",O,"Опубликовать"))],8,z),c.value?(a(),i("p",G,S(c.value),1)):h("",!0)]))}},J={class:"profile setting_avatar"},K={key:0,class:"settings_icon"},Q={class:"profile-info"},W={class:"profile-text"},X={class:"profile-name"},Y={key:0},Z={key:0,class:"create-and-posts"},ee={__name:"ProfilePage",setup(B){const p=F(),m=$(),t=w(()=>m.user),o=s(p.params.username),c=s(o.value),d=s(""),y=s(""),l=s(""),_=s(""),e=V(),r=s(!1),x=w(()=>e.getUserPosts(l.value)),C=()=>{const u=new URL(window.location.href);u.searchParams.set("username",o.value),window.history.pushState({},"",u.href),N()},N=async()=>{const u=window.location,v=u.pathname.substring(u.pathname.lastIndexOf("/")+1),f=await m.getUserByUsername(o.value);o.value=v,d.value=f.email,y.value=f.avatar_url,l.value=f.id,await E()},E=async()=>{try{r.value=!0,await e.fetchUserPosts(l.value,{forceRefresh:!0})}catch(u){_.value=u.message||"Ошибка загрузки постов"}finally{r.value=!1}};return A(async()=>{C()}),(u,v)=>{const f=I("router-link");return a(),i("section",null,[n("section",J,[t.value?(a(),i("div",K,[l.value===t.value.id?(a(),b(f,{key:0,to:"/settings"},{default:L(()=>v[0]||(v[0]=[n("span",{class:"material-icons"},"⚙️",-1)])),_:1})):h("",!0)])):h("",!0),n("div",Q,[g(M,{size:50,username:c.value},null,8,["username"]),n("div",W,[n("h2",X,S(c.value),1)])])]),t.value?(a(),i("div",Y,[l.value===t.value.id?(a(),i("section",Z,[g(H),g(k,{posts:x.value},null,8,["posts"])])):l.value?(a(),b(k,{key:1,posts:x.value},null,8,["posts"])):h("",!0)])):h("",!0),v[1]||(v[1]=D("⚙️ "))])}}},re=T(ee,[["__scopeId","data-v-11f2649e"]]);export{re as default};
