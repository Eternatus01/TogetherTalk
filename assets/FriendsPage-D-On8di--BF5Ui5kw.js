import{e as y,Z as S,g as j,U as q,S as _,f as F,$ as d,d as f,C as L,B as u,o as p,b as N,h as C,i as g,k as P,j as k,t as B,L as D,A as b,l as U,c as w}from"./index-QomUHjFO.js";const O={key:0},Z=["onClick"],x=["onClick"],z={__name:"FriendsList",props:{friends:Array,user:Object},setup(r){const l=L(),n=r,i=a=>{l.push({name:"Profile",params:{username:a.username}})},t=async a=>{try{if(!n.user){console.error("Пользователь не авторизован");return}const{data:e,error:s}=await w.from("chats").select("*").or(`user1_id.eq.${n.user.id},user2_id.eq.${n.user.id}`).or(`user1_id.eq.${a.id},user2_id.eq.${a.id}`);if(s)throw s;let o;if(e.length>0)o=e[0].id;else{const{data:v,error:m}=await w.from("chats").insert([{user1_id:n.user.id,user2_id:a.id}]).select();if(m)throw m;o=v[0].id}l.push({name:"ChatsDetails",params:{id:o}})}catch(e){console.error("Ошибка при создании чата:",e)}};return(a,e)=>(u(),d("div",null,[e[0]||(e[0]=p("h2",null,"Друзья",-1)),p("ul",null,[r.friends.length===0?(u(),d("li",O,"Список друзей пуст")):N("",!0),(u(!0),d(C,null,g(r.friends,s=>(u(),d("li",{key:s.id},[b(U(s.username)+" ",1),p("button",{onClick:o=>t(s)},"Написать сообщение",8,Z),p("button",{onClick:o=>i(s)},"Профиль",8,x)]))),128))])]))}},E=y(z,[["__scopeId","data-v-8c1fea55"]]),G={__name:"UserSearch",props:{search:String,users:Array,loadUsers:Function},emits:["update:search"],setup(r,{emit:l}){const n=r,i=l,t=F(n.search);P(t,e=>{i("update:search",e)});const a=()=>{n.loadUsers()};return(e,s)=>(u(),d("div",null,[k(p("input",{type:"search","onUpdate:modelValue":s[0]||(s[0]=o=>t.value=o),onInput:a,placeholder:"Поиск пользователей..."},null,544),[[B,t.value]]),k(p("p",null,"Пользователи не найдены.",512),[[D,r.users.length===0]])]))}},H=y(G,[["__scopeId","data-v-88cc3f1b"]]),J=["onClick","disabled"],M=["onClick"],Q={__name:"UserList",props:{users:Array,addFriend:Function,removeFriend:Function,isFriend:Function,notices:{type:Array,default:()=>[]}},setup(r){const l=r,n=_(()=>{const i={};return l.notices.forEach(t=>{i[t.sender_id]=t.notice_type==="sentFriend"}),i});return(i,t)=>(u(),d("ul",null,[(u(!0),d(C,null,g(r.users,a=>(u(),d("li",{key:a.id},[b(U(a.username)+" ",1),r.isFriend(a.id)?(u(),d("button",{key:1,onClick:e=>r.removeFriend(a)},"Удалить из друзей",8,M)):(u(),d("button",{key:0,onClick:e=>r.addFriend(a),disabled:n.value[a.id]}," Добавить в друзья ",8,J))]))),128))]))}},R=y(Q,[["__scopeId","data-v-de0463e1"]]),V={__name:"FriendsPage",setup(r){const l=S(),n=j(),i=q(),t=_(()=>n.friends),a=F([]),e=_(()=>l.user),s=F(""),o=_(()=>i.notices),v=async()=>{a.value=await l.getUsers(s.value)},m=c=>t.value.some(h=>h.id===c),$=async c=>{await i.addNotice(e.value.id,c.id,`Пользователь ${e.value.username} хочет добавить вас в друзья.`,"addFriend"),await i.addNotice(c.id,e.value.id,`Отправлена заявка ${c.username} `,"sentFriend"),await v(),await n.getFriends(e.value.id),await i.getNotices(e.value.id)},A=async c=>{await n.removeFriend(e.value.id,c.id),await v()};return(c,h)=>(u(),d("div",null,[f(E,{friends:t.value,user:e.value},null,8,["friends","user"]),f(H,{search:s.value,"onUpdate:search":h[0]||(h[0]=I=>s.value=I),users:a.value,loadUsers:v},null,8,["search","users"]),f(R,{users:a.value,addFriend:$,removeFriend:A,isFriend:m,notices:o.value},null,8,["users","notices"])]))}};export{V as default};
