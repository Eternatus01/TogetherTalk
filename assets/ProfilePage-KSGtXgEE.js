import{u as $,_ as k}from"./PostList-DSuxwCCR.js";import{u as S,r as s,c as w,e as a,a as i,h as U,v as P,b as n,t as V,i as h,s as R,_ as A,o as D,p as b,d as g,q as F,x as I,y as L}from"./index-CJNLzwgk.js";import{A as M}from"./Avatar-fWPbL5YK.js";import"./DisplayAvatar-DIsAQHXj.js";const T={class:"create-post"},q=["disabled"],z={key:0},O={key:1},j={key:0,class:"error"},G={__name:"CreatePost",setup(B){const v=S(),m=$(),t=s(""),o=s(""),c=s(""),d=s(!1),y=w(()=>t.value.trim().length>0),l=async()=>{var _;try{if(c.value="",d.value=!0,!((_=v.user)!=null&&_.id))throw new Error("Пользователь не авторизован");const{data:e,error:r}=await R.from("posts").insert({user_id:v.user.id,title:o.value.trim()||"Без названия",username:v.user.username,text:t.value.trim()}).select("*").single();if(r)throw r;m.posts=[e,...m.posts],t.value="",o.value=""}catch(e){c.value=e.message||"Ошибка при создании поста",console.error("Post creation error:",e)}finally{d.value=!1}};return(_,e)=>(a(),i("div",T,[U(n("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=r=>o.value=r),placeholder:"Заголовок",class:"post-input",maxlength:"60"},null,512),[[P,o.value]]),U(n("textarea",{"onUpdate:modelValue":e[1]||(e[1]=r=>t.value=r),placeholder:"Что у вас нового?",rows:"3",class:"post-textarea",maxlength:"1000"},null,512),[[P,t.value]]),n("button",{onClick:l,disabled:!y.value||d.value,class:"post-button"},[d.value?(a(),i("span",O,"Публикация...")):(a(),i("span",z,"Опубликовать"))],8,q),c.value?(a(),i("p",j,V(c.value),1)):h("",!0)]))}},H={class:"profile"},J={key:0},K={class:"profile-info"},Q={class:"profile-text"},W={class:"profile-name"},X={key:0},Y={key:0,class:"create-and-posts"},Z={__name:"ProfilePage",setup(B){const v=F(),m=S(),t=w(()=>m.user),o=s(v.params.username),c=s(o.value),d=s(""),y=s(""),l=s(""),_=s(""),e=$(),r=s(!1),x=w(()=>e.getUserPosts(l.value)),C=()=>{const u=new URL(window.location.href);u.searchParams.set("username",o.value),window.history.pushState({},"",u.href),E()},E=async()=>{const u=window.location,p=u.pathname.substring(u.pathname.lastIndexOf("/")+1),f=await m.getUserByUsername(o.value);o.value=p,d.value=f.email,y.value=f.avatar_url,l.value=f.id,await N()},N=async()=>{try{r.value=!0,await e.fetchUserPosts(l.value,{forceRefresh:!0})}catch(u){_.value=u.message||"Ошибка загрузки постов"}finally{r.value=!1}};return D(async()=>{C()}),(u,p)=>{const f=I("router-link");return a(),i("section",null,[n("section",H,[t.value?(a(),i("div",J,[l.value===t.value.id?(a(),b(f,{key:0,to:"/settings"},{default:L(()=>p[0]||(p[0]=[n("span",{class:"material-icons"},"Настройки",-1)])),_:1})):h("",!0)])):h("",!0),n("div",K,[g(M,{size:50,username:c.value},null,8,["username"]),n("div",Q,[p[1]||(p[1]=n("small",null,"Username",-1)),n("h2",W,V(c.value),1)])])]),t.value?(a(),i("div",X,[l.value===t.value.id?(a(),i("section",Y,[g(G),g(k,{posts:x.value},null,8,["posts"])])):l.value?(a(),b(k,{key:1,posts:x.value},null,8,["posts"])):h("",!0)])):h("",!0)])}}},oe=A(Z,[["__scopeId","data-v-940011da"]]);export{oe as default};
